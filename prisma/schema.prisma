generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Announcement {
  id             String       @id @default(cuid())
  title          String
  content        String
  priority       Int          @default(0)
  expiresAt      DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  @@index([expiresAt])
  @@index([organizationId])
}

model CertificationType {
  id               String              @id @default(cuid())
  name             String
  description      String?
  validityMonths   Int                 @default(12)
  isRequired       Boolean             @default(false)
  requiredForRoles String              @default("[]")
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  organizationId   String
  organization     Organization        @relation(fields: [organizationId], references: [id])
  certifications   UserCertification[]

  @@index([organizationId])
}

model HolidayRequest {
  id        String   @id @default(cuid())
  startDate DateTime
  endDate   DateTime
  hours     Int      @default(8)
  reason    String?
  status    String   @default("PENDING")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String
  user      User     @relation(fields: [userId], references: [id])

  @@index([startDate, endDate])
  @@index([userId])
}

model Location {
  id                  String           @id @default(cuid())
  name                String
  address             String?
  latitude            Float?
  longitude           Float?
  clockInRadiusMetres Int              @default(100)
  isActive            Boolean          @default(true)
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt
  organizationId      String
  breakRules          String?
  organization        Organization     @relation(fields: [organizationId], references: [id])
  events              Event[]
  growthActivityLogs  GrowthActivityLog[] @relation("GrowthActivityLogs")
  growthTargets       GrowthTarget[]      @relation("GrowthTargets")
  growthMetrics       GrowthMetric[]      @relation("GrowthMetrics")
  staff               LocationStaff[]
  shifts              Shift[]
  primaryUsers        User[]
  maintenanceLogs     MaintenanceLog[]
  spendRequests       SpendRequest[]
  cashTransactions    CashTransaction[]
  settingSignoffs     SettingSignoff[]  @relation("SettingSignoffs")

  @@index([organizationId])
}

model LocationStaff {
  id         String   @id @default(cuid())
  createdAt  DateTime @default(now())
  locationId String
  userId     String
  location   Location @relation(fields: [locationId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@unique([locationId, userId])
  @@index([userId])
}

model Message {
  id         String        @id @default(cuid())
  content    String
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  senderId   String
  receiverId String?
  shiftId    String?
  receiver   User?         @relation("Message_receiverIdToUser", fields: [receiverId], references: [id])
  sender     User          @relation("Message_senderIdToUser", fields: [senderId], references: [id])
  shift      Shift?        @relation(fields: [shiftId], references: [id])
  reads      MessageRead[]

  @@index([createdAt])
  @@index([receiverId])
  @@index([senderId])
  @@index([shiftId])
}

model MessageRead {
  id        String   @id @default(cuid())
  readAt    DateTime @default(now())
  messageId String
  userId    String
  message   Message  @relation(fields: [messageId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@unique([messageId, userId])
  @@index([userId])
}

model Notification {
  id        String   @id @default(cuid())
  type      String
  title     String
  message   String
  link      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  userId    String
  user      User     @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([isRead])
  @@index([userId])
}

model Organization {
  id                    String                 @id @default(cuid())
  name                  String
  timezone              String                 @default("UTC")
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  breakRules            String                 @default("[{\"minHours\":4,\"breakMinutes\":15},{\"minHours\":6,\"breakMinutes\":30},{\"minHours\":8,\"breakMinutes\":60}]")
  clockInWindowMinutes  Int                    @default(15)
  clockOutGraceMinutes  Int                    @default(30)
  shiftReminderHours    Int                    @default(24)
  locationLatitude      Float?
  locationLongitude     Float?
  clockInRadiusMetres   Int                    @default(100)
  requireGeolocation    Boolean                @default(true)
  announcements         Announcement[]
  certificationTypes    CertificationType[]
  complianceItems       ComplianceItem[]
  events                Event[]
  growthActivities      GrowthActivity[]
  growthActivityLogs    GrowthActivityLog[]
  growthTargets         GrowthTarget[]
  growthMetrics         GrowthMetric[]
  locations             Location[]
  shifts                Shift[]
  shiftCategories       ShiftCategory[]
  shiftTemplates        ShiftTemplate[]
  staffRoles            StaffRole[]
  trainingDocuments     TrainingDocument[]
  users                 User[]
  maintenanceCheckTypes MaintenanceCheckType[]
  maintenanceLogs       MaintenanceLog[]
  spendRequests         SpendRequest[]
  cashTransactions      CashTransaction[]
  settingSignoffs       SettingSignoff[]
}

model Shift {
  id                    String         @id @default(cuid())
  title                 String
  description           String?
  startTime             DateTime
  endTime               DateTime
  status                String         @default("SCHEDULED")
  isOpen                Boolean        @default(false)
  scheduledBreakMinutes Int            @default(0)
  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt
  organizationId        String
  assignedToId          String?
  createdById           String?
  templateId            String?
  categoryId            String?
  locationId            String?
  messages              Message[]
  assignedTo            User?          @relation("Shift_assignedToIdToUser", fields: [assignedToId], references: [id])
  category              ShiftCategory? @relation(fields: [categoryId], references: [id])
  createdBy             User?          @relation("Shift_createdByIdToUser", fields: [createdById], references: [id])
  location              Location?      @relation(fields: [locationId], references: [id])
  organization          Organization   @relation(fields: [organizationId], references: [id])
  template              ShiftTemplate? @relation(fields: [templateId], references: [id])
  swapRequests          SwapRequest[]
  timeEntries           TimeEntry[]

  @@index([assignedToId])
  @@index([categoryId])
  @@index([locationId])
  @@index([organizationId])
  @@index([startTime, endTime])
}

model ShiftCategory {
  id             String             @id @default(cuid())
  name           String
  hourlyRate     Float              // Default rate (can be overridden per user)
  color          String             @default("#3b82f6")
  isActive       Boolean            @default(true)
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  organizationId String
  shifts         Shift[]
  organization   Organization       @relation(fields: [organizationId], references: [id])
  templates      ShiftTemplate[]
  userRates      UserCategoryRate[]

  @@index([organizationId])
}

model ShiftTemplate {
  id             String         @id @default(cuid())
  name           String
  description    String?
  defaultTitle   String?
  startTime      String
  endTime        String
  daysOfWeek     String         @default("[]")
  isActive       Boolean        @default(true)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  organizationId String
  categoryId     String?
  shifts         Shift[]
  category       ShiftCategory? @relation(fields: [categoryId], references: [id])
  organization   Organization   @relation(fields: [organizationId], references: [id])

  @@index([categoryId])
  @@index([organizationId])
}

model StaffAvailability {
  id           String    @id @default(cuid())
  dayOfWeek    Int
  startTime    String
  endTime      String
  isRecurring  Boolean   @default(true)
  specificDate DateTime?
  notes        String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  userId       String
  user         User      @relation(fields: [userId], references: [id])

  @@index([dayOfWeek])
  @@index([userId])
}

model StaffRole {
  id             String       @id @default(cuid())
  name           String
  code           String
  description    String?
  color          String       @default("#6b7280")
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  @@unique([organizationId, code])
  @@index([organizationId])
}

model SwapRequest {
  id         String   @id @default(cuid())
  type       String
  message    String?
  status     String   @default("PENDING")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  shiftId    String
  fromUserId String
  toUserId   String?
  fromUser   User     @relation("SwapRequest_fromUserIdToUser", fields: [fromUserId], references: [id])
  shift      Shift    @relation(fields: [shiftId], references: [id])
  toUser     User?    @relation("SwapRequest_toUserIdToUser", fields: [toUserId], references: [id])

  @@index([fromUserId])
  @@index([shiftId])
  @@index([toUserId])
}

model TimeEntry {
  id                String    @id @default(cuid())
  clockIn           DateTime
  clockOut          DateTime?
  breakStart        DateTime?
  breakEnd          DateTime?
  totalBreak        Int       @default(0)
  notes             String?
  status            String    @default("PENDING")
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  clockInLatitude   Float?
  clockInLongitude  Float?
  clockOutLatitude  Float?
  clockOutLongitude Float?
  userId            String
  shiftId           String?
  shift             Shift?    @relation(fields: [shiftId], references: [id])
  user              User      @relation(fields: [userId], references: [id])

  @@index([clockIn])
  @@index([shiftId])
  @@index([userId])
}

// UNIFIED COMPLIANCE SYSTEM
// Merges Training (policies to acknowledge) and Certifications (qualifications to track)
model ComplianceItem {
  id               String           @id @default(cuid())
  name             String           // "Fire Safety Policy" or "First Aid Certificate"
  description      String?
  type             String           // "POLICY" or "QUALIFICATION"
  validityMonths   Int              @default(12)
  isRequired       Boolean          @default(false)
  requiredForRoles String           @default("[]") // JSON array of staff roles
  // For POLICY type (document to read/acknowledge)
  fileUrl          String?
  fileName         String?
  // For QUALIFICATION type
  requiresProof    Boolean          @default(false) // Whether to upload certificate
  isActive         Boolean          @default(true)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  organizationId   String
  organization     Organization     @relation(fields: [organizationId], references: [id])
  userRecords      UserCompliance[]

  @@index([organizationId])
  @@index([type])
}

model UserCompliance {
  id                String         @id @default(cuid())
  // Dates
  issueDate         DateTime       @default(now()) // When issued/acknowledged
  expiryDate        DateTime       // When it expires
  // Employee Signature
  signature         String?        // User's digital signature (typed name)
  signedAt          DateTime?      // When they signed
  // For QUALIFICATIONs
  certificateNumber String?        // External certificate number
  proofUrl          String?        // Uploaded certificate image
  notes             String?
  // For PERFORMANCE REVIEWs
  rating            Int?           // Performance rating (1-5)
  managerNotes      String?        // Manager's feedback
  employeeComments  String?        // Employee's response/comments
  goals             String?        // Goals for next review period
  managerSignature  String?        // Manager's signature
  managerSignedAt   DateTime?      // When manager signed
  reviewedById      String?        // Manager who conducted the review
  // Status
  status            String         @default("ACTIVE") // ACTIVE, EXPIRED, REVOKED
  // Relations
  userId            String
  complianceItemId  String
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  user             User           @relation(fields: [userId], references: [id])
  complianceItem   ComplianceItem @relation(fields: [complianceItemId], references: [id])

  @@unique([userId, complianceItemId])
  @@index([userId])
  @@index([complianceItemId])
  @@index([reviewedById])
  @@index([expiryDate])
}

// DEPRECATED - Keep temporarily for migration, remove after data migrated
model TrainingDocument {
  id               String            @id @default(cuid())
  title            String
  description      String?
  fileUrl          String
  fileName         String
  validityMonths   Int               @default(12)
  isRequired       Boolean           @default(false)
  requiredForRoles String            @default("[]")
  isActive         Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  organizationId   String
  organization     Organization      @relation(fields: [organizationId], references: [id])
  signoffs         TrainingSignoff[]

  @@index([organizationId])
}

model TrainingSignoff {
  id         String           @id @default(cuid())
  signedAt   DateTime         @default(now())
  expiresAt  DateTime
  signature  String?
  userId     String
  documentId String
  document   TrainingDocument @relation(fields: [documentId], references: [id])
  user       User             @relation(fields: [userId], references: [id])

  @@unique([userId, documentId])
  @@index([expiresAt])
  @@index([userId])
}

model User {
  id                String              @id @default(cuid())
  email             String              @unique
  name              String
  password          String
  role              String              @default("EMPLOYEE")
  staffRole         String              @default("DESK")
  paymentType       String              @default("HOURLY") // "HOURLY" or "MONTHLY"
  monthlySalary     Float?              // Monthly salary before tax (for MONTHLY payment type)
  avatarUrl         String?
  phone             String?
  holidayBalance    Int                 @default(200)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  organizationId    String
  primaryLocationId String?
  eventsCreated     Event[]             @relation("EventsCreated")
  growthActivitiesCompleted GrowthActivityLog[] @relation("GrowthActivitiesCompleted")
  growthTargetsCreated      GrowthTarget[]      @relation("GrowthTargetsCreated")
  growthMetricsRecorded     GrowthMetric[]      @relation("GrowthMetricsRecorded")
  holidayRequests   HolidayRequest[]
  locationAccess    LocationStaff[]
  messagesReceived  Message[]           @relation("Message_receiverIdToUser")
  messagesSent      Message[]           @relation("Message_senderIdToUser")
  messageReads      MessageRead[]
  notifications     Notification[]
  assignedShifts    Shift[]             @relation("Shift_assignedToIdToUser")
  createdShifts     Shift[]             @relation("Shift_createdByIdToUser")
  availability      StaffAvailability[]
  swapRequestsFrom  SwapRequest[]       @relation("SwapRequest_fromUserIdToUser")
  swapRequestsTo    SwapRequest[]       @relation("SwapRequest_toUserIdToUser")
  timeEntries       TimeEntry[]
  trainingSignoffs  TrainingSignoff[]
  organization      Organization        @relation(fields: [organizationId], references: [id])
  primaryLocation   Location?           @relation(fields: [primaryLocationId], references: [id])
  certifications    UserCertification[]
  categoryRates     UserCategoryRate[]
  complianceRecords UserCompliance[]
  maintenanceLogs   MaintenanceLog[]
  spendRequestsCreated  SpendRequest[] @relation("SpendRequestsCreated")
  spendRequestsReviewed SpendRequest[] @relation("SpendRequestsReviewed")
  cashTransactionsLogged CashTransaction[] @relation("CashTransactionsLogged")
  settingSignoffs        SettingSignoff[]  @relation("SettingSignoffs")

  @@index([email])
  @@index([organizationId])
  @@index([staffRole])
}

model UserCertification {
  id                     String            @id @default(cuid())
  issueDate              DateTime
  expiryDate             DateTime?
  certificateNumber      String?
  notes                  String?
  status                 String            @default("ACTIVE")
  lastExpiryNotification DateTime?
  staffSignature         String?           // Staff counter-signature
  staffSignedAt          DateTime?         // When staff signed
  createdAt              DateTime          @default(now())
  updatedAt              DateTime          @updatedAt
  userId                 String
  certificationTypeId    String
  certificationType      CertificationType @relation(fields: [certificationTypeId], references: [id])
  user                   User              @relation(fields: [userId], references: [id])

  @@index([certificationTypeId])
  @@index([expiryDate])
  @@index([userId])
}

model UserCategoryRate {
  id         String        @id @default(cuid())
  hourlyRate Float
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  userId     String
  categoryId String
  category   ShiftCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  user       User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, categoryId])
  @@index([userId])
  @@index([categoryId])
}

// EVENTS SYSTEM
// Events, group bookings, and parties for visibility on the schedule
model Event {
  id             String    @id @default(cuid())
  title          String
  description    String?
  eventType      String    // PARTY, GROUP, TRAINING, COMPETITION, OTHER
  startTime      DateTime
  endTime        DateTime
  expectedGuests Int?      // Expected number of attendees
  staffRequired  Int?      // Suggested extra staff needed
  color          String    @default("#f59e0b") // Amber default
  isActive       Boolean   @default(true)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  locationId     String?
  location       Location? @relation(fields: [locationId], references: [id])

  createdById    String?
  createdBy      User?     @relation("EventsCreated", fields: [createdById], references: [id])

  @@index([organizationId])
  @@index([locationId])
  @@index([startTime, endTime])
}

// CENTRE GROWTH & PERFORMANCE SYSTEM
// Track activities that drive membership, kids club, and external groups growth

// Predefined activities that staff can complete to drive growth
model GrowthActivity {
  id             String   @id @default(cuid())
  name           String   // "Follow up trial visitor", "Call lapsed member"
  description    String?
  category       String   // MEMBERSHIP, KIDS_CLUB, EXTERNAL_GROUPS
  activityType   String   // LEAD_GEN, RETENTION, CONVERSION, OUTREACH
  points         Int      @default(5) // Impact points for gamification
  suggestedFreq  String   @default("WEEKLY") // DAILY, WEEKLY, MONTHLY
  isActive       Boolean  @default(true)
  sortOrder      Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  activityLogs   GrowthActivityLog[]

  @@index([organizationId])
  @@index([category])
}

// Log of completed growth activities
model GrowthActivityLog {
  id             String    @id @default(cuid())
  completedAt    DateTime  @default(now())
  notes          String?   // What happened, any details
  outcome        String    @default("COMPLETED") // COMPLETED, SUCCESSFUL, NO_ANSWER, FOLLOW_UP_NEEDED
  contactName    String?   // Name of person contacted (if applicable)
  contactInfo    String?   // Email/phone (if applicable)
  followUpDate   DateTime? // When to follow up
  pointsEarned   Int       @default(0)

  activityId     String
  activity       GrowthActivity @relation(fields: [activityId], references: [id])
  completedById  String
  completedBy    User      @relation("GrowthActivitiesCompleted", fields: [completedById], references: [id])
  locationId     String?
  location       Location? @relation("GrowthActivityLogs", fields: [locationId], references: [id])
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([organizationId])
  @@index([completedById])
  @@index([activityId])
  @@index([completedAt])
  @@index([locationId])
}

// Weekly/monthly targets set by managers
model GrowthTarget {
  id             String   @id @default(cuid())
  weekStart      DateTime // Monday of the target week
  category       String   // MEMBERSHIP, KIDS_CLUB, EXTERNAL_GROUPS
  activityTarget Int      // Number of activities to complete
  metricTarget   Int?     // Target for actual number (optional)
  notes          String?

  locationId     String?
  location       Location? @relation("GrowthTargets", fields: [locationId], references: [id])
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdById    String?
  createdBy      User?    @relation("GrowthTargetsCreated", fields: [createdById], references: [id])
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([organizationId, locationId, weekStart, category])
  @@index([organizationId])
  @@index([weekStart])
  @@index([locationId])
}

// Actual metric snapshots (current numbers)
model GrowthMetric {
  id             String   @id @default(cuid())
  recordedAt     DateTime @default(now())
  category       String   // MEMBERSHIP, KIDS_CLUB, EXTERNAL_GROUPS
  metricType     String   // TOTAL, NEW_THIS_WEEK, NEW_THIS_MONTH, CHURNED
  value          Int
  notes          String?

  locationId     String?
  location       Location? @relation("GrowthMetrics", fields: [locationId], references: [id])
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  recordedById   String
  recordedBy     User     @relation("GrowthMetricsRecorded", fields: [recordedById], references: [id])
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([organizationId])
  @@index([recordedAt])
  @@index([category])
  @@index([locationId])
}

// MAINTENANCE LOGGING SYSTEM
// Defines check types with configurable frequency
model MaintenanceCheckType {
  id             String       @id @default(cuid())
  name           String       // "Matting", "Drills", "Ladders", "Hold Checks"
  description    String?
  frequencyDays  Int          @default(1) // 1=daily, 7=weekly, etc.
  isActive       Boolean      @default(true)
  sortOrder      Int          @default(0)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  logs           MaintenanceLog[]

  @@index([organizationId])
}

// Records each maintenance check
model MaintenanceLog {
  id             String               @id @default(cuid())
  checkTypeId    String
  checkType      MaintenanceCheckType @relation(fields: [checkTypeId], references: [id])
  locationId     String
  location       Location             @relation(fields: [locationId], references: [id])

  // Check result
  status         String               @default("PASS") // PASS, FAIL, NEEDS_ATTENTION
  notes          String?
  issues         String?              // JSON array of flagged issues

  // Manager sign-off
  signature      String               // Manager's typed name (required)
  signedAt       DateTime             @default(now())
  signedById     String
  signedBy       User                 @relation(fields: [signedById], references: [id])

  // Timestamps
  checkDate      DateTime             @default(now()) // Date of the check
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  organizationId String
  organization   Organization         @relation(fields: [organizationId], references: [id])

  @@index([locationId])
  @@index([checkTypeId])
  @@index([organizationId])
  @@index([checkDate])
}

// SPEND TRACKING & APPROVAL SYSTEM
// Managers submit spend requests for approval by admins
model SpendRequest {
  id             String    @id @default(cuid())
  title          String                        // Brief description
  description    String?                       // What it is
  justification  String                        // Why it is needed
  amount         Float                         // Total spend amount
  category       String                        // EQUIPMENT, SUPPLIES, MAINTENANCE, MARKETING, TRAINING, OTHER
  status         String    @default("PENDING") // PENDING, APPROVED, REJECTED

  // Approval tracking
  reviewedAt     DateTime?
  reviewedById   String?
  reviewedBy     User?     @relation("SpendRequestsReviewed", fields: [reviewedById], references: [id])
  reviewNotes    String?                       // Admin can add notes on approval/rejection

  // Metadata
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relationships
  requestedById  String
  requestedBy    User      @relation("SpendRequestsCreated", fields: [requestedById], references: [id])

  locationId     String?
  location       Location? @relation(fields: [locationId], references: [id])

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  @@index([organizationId])
  @@index([status])
  @@index([createdAt])
  @@index([requestedById])
}

// CASH MANAGEMENT SYSTEM
// Track cash in the building with a running total
model CashTransaction {
  id             String    @id @default(cuid())
  type           String                        // TAKING, BANKING, PURCHASE, ADJUSTMENT
  amount         Float                         // Positive for IN, negative for OUT
  notes          String?                       // Reason for the transaction

  // Metadata
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Who logged it
  loggedById     String
  loggedBy       User      @relation("CashTransactionsLogged", fields: [loggedById], references: [id])

  // Optional location
  locationId     String?
  location       Location? @relation(fields: [locationId], references: [id])

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  @@index([organizationId])
  @@index([locationId])
  @@index([createdAt])
  @@index([type])
}

// SETTING SIGN-OFF SYSTEM
// Track route setting days with sign-off checklist
model SettingSignoff {
  id                   String    @id @default(cuid())

  // Setters
  externalSetterName   String                        // Name of external setter
  inHouseSetterName    String                        // Name of in-house setter

  // Checklist confirmations
  climbsTested         Boolean   @default(false)    // Climbs tested and changed where needed
  downClimbJugsOk      Boolean   @default(false)    // Down climb jugs in appropriate areas
  matsChecked          Boolean   @default(false)    // Mats checked for objects and hoovered

  // Photos (JSON array of URLs)
  photos               String    @default("[]")     // Array of photo URLs

  // Notes
  notes                String?                       // Anything to note from setting day

  // Metadata
  settingDate          DateTime  @default(now())    // Date of the setting
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  // Who signed off
  signedOffById        String
  signedOffBy          User      @relation("SettingSignoffs", fields: [signedOffById], references: [id])

  // Location (site)
  locationId           String
  location             Location  @relation("SettingSignoffs", fields: [locationId], references: [id])

  organizationId       String
  organization         Organization @relation(fields: [organizationId], references: [id])

  @@index([organizationId])
  @@index([locationId])
  @@index([settingDate])
  @@index([signedOffById])
}
